<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>UltraSOP Generator</title>

  <!-- Minimal styles just so the layout is readable; keep your own CSS as needed -->
  <style>
    :root { --ink:#111827; --muted:#6b7280; --accent:#ff7a1a; --bg:#faf7f4; }
    body { margin:0; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink); background: #fff; }
    .wrap { max-width:1200px; margin:40px auto; padding:0 16px; }
    header.nav { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:20px; }
    header .left { display:flex; align-items:center; gap:14px; }
    .brand { font-weight:800; font-size:28px; letter-spacing:.3px; }
    .muted { color: var(--muted); }
    .btn { background:#fff; border:1px solid #e5e7eb; padding:8px 12px; border-radius:10px; cursor:pointer; }
    .btn.primary { background:var(--accent); border-color:var(--accent); color:#fff; }
    .btn.ghost { background:transparent; border:1px dashed #e5e7eb; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    input.input, textarea.textarea { width:100%; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; }
    textarea.textarea { min-height:120px; resize:vertical; }
    .grid { display:grid; gap:18px; }
    .appgrid { display:grid; grid-template-columns: 280px 1fr 1fr; gap:18px; align-items:start; }
    .aside { background: #fff7f1; border:1px solid #ffe8d6; border-radius:16px; padding:12px; }
    .pane  { background:#fff; border:1px solid #f0f0f0; border-radius:16px; padding:14px; }
    .qtpl-btn { display:block; width:100%; text-align:left; border:1px solid #f0f0f0; padding:10px 12px; border-radius:10px; background:#fff; margin-bottom:8px; cursor:pointer; }
    .section-title { font-weight:700; margin: 10px 0 8px; }
    .steprow { display:grid; grid-template-columns: 28px 1fr; gap:8px; padding:10px; border:1px solid #f3f4f6; border-radius:12px; margin-bottom:8px; background:#fff; }
    .stepnum { width:28px; height:28px; display:inline-grid; place-items:center; border-radius:999px; background:#fff1e7; color:#9a4a00; font-weight:700; }
    .chipbtn { font-size:12px; padding:6px 8px; border-radius:999px; }
    .chipbtn.active { background:#fff1e7; border-color:#ffdfc7; }
    .tabbar { display:flex; gap:8px; margin-bottom:10px; }
    .tabbtn { border:1px solid #f0f0f0; background:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; }
    .tabbtn.active { background:#fff1e7; border-color:#ffdfc7; }
    .tab { display:none; }
    .tab.visible { display:block; }
    .card { border:1px solid #f3f4f6; border-radius:12px; padding:12px; background:#fff; margin-bottom:10px; }
    #preview { background:linear-gradient(#fff, #fffbf7); border:1px solid #ffe7d2; border-radius:14px; min-height:260px; padding:12px; }
    .toolbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .toolbar .spacer { flex:1; }
    #enhance-status { display:none; align-items:center; gap:8px; font-size:12px; color:var(--muted); }
    #toast { position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:#111827; color:#fff; padding:10px 14px; border-radius:999px; opacity:0; pointer-events:none; transition:.2s; }
    #toast.show { opacity:1; }
    #overlay { position:fixed; inset:0; background:rgba(17,24,39,.45); display:none; place-items:center; z-index:50; }
    #overlay.show { display:grid; }
    .modal { position:fixed; inset:0; display:none; place-items:center; background:rgba(17,24,39,.45); z-index:60; }
    .modal .sheet { width:min(680px, 92vw); background:#fff; border-radius:16px; border:1px solid #f0f0f0; padding:16px; }
    .modal.show { display:grid; }
    .sheet .head { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .sheet .seg { display:flex; gap:8px; margin:10px 0; }
    .segbtn { border:1px solid #eee; padding:6px 8px; border-radius:10px; cursor:pointer; }
    .segbtn.active { background:#f7f7f7; }
    footer { margin-top:60px; padding:20px 0; border-top:1px solid #f3f4f6; color:var(--muted); font-size:13px; }
    .ownergroup, .durgroup { display:none; }
    .ownergroup.show, .durgroup.show { display:block; }
  </style>

  <!-- Expose your Supabase keys here (replace the placeholders) -->
  <script>
    window.ENV = {
      // ⬇️ paste your real values from Supabase Project Settings
      SUPABASE_URL:        "https://YOUR-PROJECT.supabase.co",
      SUPABASE_ANON_KEY:   "YOUR-ANON-KEY"
    };
  </script>

  <!-- jsPDF for PDF export (app.js checks window.jspdf.jsPDF) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap" id="app">
    <!-- Top bar -->
    <header class="nav">
      <div class="left">
        <div class="brand">UltraSOP Generator</div>
        <span class="muted">Record, paste, or import — then edit steps and save versions.</span>
      </div>
      <div class="toolbar">
        <button id="btn-rewrite-all" class="btn">Enhance Steps</button>
        <button id="btn-save" class="btn">Save Version</button>
        <button id="btn-dup" class="btn">Duplicate</button>
        <span id="metrics" class="muted" style="margin-left:8px"></span>
        <div class="spacer"></div>
        <button id="nav-signin" class="btn">Sign in</button>
      </div>
    </header>

    <!-- Search + actions row -->
    <div class="grid" style="margin-bottom:10px">
      <input class="input" placeholder="Search SOPs..." />
    </div>

    <!-- Main grid -->
    <div class="appgrid">
      <!-- Aside: tabs + quick templates + my sops -->
      <aside class="aside">
        <div class="tabbar">
          <button class="tabbtn active" data-tab="editor">Editor</button>
          <button class="tabbtn" data-tab="versions">Versions</button>
          <button class="tabbtn" data-tab="settings">Settings</button>
        </div>

        <div class="section-title">Quick templates</div>
        <div id="qtpl-list"></div>

        <div class="section-title">My SOPs</div>
        <div id="my-sops"></div>
      </aside>

      <!-- Editor pane -->
      <section class="pane tab visible" id="tab-editor" aria-label="Editor">
        <div class="grid">
          <div>
            <label class="muted">Title</label>
            <input id="sop-title" class="input" placeholder="Title..." />
          </div>

          <div>
            <label class="muted">Summary</label>
            <textarea id="sop-summary" class="textarea" placeholder="Short context / scope..."></textarea>
          </div>

          <div class="toolbar" style="justify-content:flex-end; gap:10px">
            <button id="btn-clear" class="btn ghost">Clear All</button>
            <div style="display:flex; gap:8px; align-items:center;">
              <button id="btn-generate-inline" class="btn primary">Generate SOP</button>
              <div id="enhance-status"><span>⏳</span><span>Enhancing…</span></div>
            </div>
          </div>

          <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
            <div>
              <div class="toolbar" style="justify-content:space-between">
                <div class="section-title">Steps</div>
                <button id="btn-add-step" class="btn">Add Step</button>
              </div>
              <ul id="steps-list" style="list-style:none; padding:0; margin:0;"></ul>

              <div class="section-title">Raw JSON (debug)</div>
              <pre id="jsonbox" style="background:#f9fafb;border:1px solid #f3f4f6;border-radius:12px;padding:10px;overflow:auto;min-height:80px"></pre>
            </div>

            <div>
              <div class="section-title">Preview</div>
              <div id="preview"></div>
              <div class="toolbar" style="margin-top:10px">
                <button id="btn-download-pdf" class="btn">Download PDF</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Versions pane -->
      <section class="pane tab" id="tab-versions" aria-label="Versions">
        <div id="versions-list"></div>
      </section>

      <!-- Settings pane -->
      <section class="pane tab" id="tab-settings" aria-label="Settings">
        <div class="card">
          <strong>Generation settings (coming soon)</strong>
          <p class="muted" style="margin:8px 0 0">
            We’ll add controls here for output depth (brief vs. detailed), tone, and document sections.
          </p>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer>
      <div class="wrap" style="padding:0">
        <span>© <span id="year"></span> UltraSOP</span>
      </div>
    </footer>
  </div>

  <!-- ===== Modals & overlays ===== -->

  <!-- Generate (paste notes) modal -->
  <div id="gen-modal" class="modal" aria-hidden="true" aria-labelledby="gen-title">
    <div class="sheet">
      <div class="head">
        <strong id="gen-title">Generate from notes</strong>
        <div style="display:flex; gap:8px">
          <button id="gen-close" class="btn">✕</button>
        </div>
      </div>

      <div class="seg">
        <button class="segbtn active" data-panel="text">Text</button>
        <button class="segbtn" data-panel="audio">Audio</button>
      </div>

      <div id="panel-text">
        <div class="grid">
          <input id="gen-title-in" class="input" placeholder="Optional: Title override" />
          <textarea id="gen-input" class="textarea" placeholder="Paste rough notes here... (bullets, numbered steps, etc.)"></textarea>
          <div id="errbox" class="card" style="display:none; color:#b91c1c; background:#fff7f7; border-color:#ffe1e1"></div>
          <div style="display:flex; gap:8px; justify-content:flex-end">
            <button id="btn-sample" class="btn">Sample text</button>
            <button id="gen-cancel" class="btn">Cancel</button>
            <button id="gen-run" class="btn primary">Generate</button>
          </div>
        </div>
      </div>

      <div id="panel-audio" style="display:none">
        <div class="card muted">Audio capture coming soon.</div>
      </div>
    </div>
  </div>

  <!-- Auth modal -->
  <div id="auth-modal" class="modal" aria-hidden="true" aria-labelledby="auth-title">
    <div class="sheet" style="max-width:520px">
      <div class="head">
        <strong id="auth-title">Sign in</strong>
        <button id="auth-close" class="btn">✕</button>
      </div>
      <p class="muted">Use a provider below:</p>
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <button id="btn-auth-google" class="btn">Continue with Google</button>
        <button id="btn-auth-github" class="btn">Continue with GitHub</button>
      </div>
      <div id="auth-err" class="card" style="display:none; color:#b91c1c; background:#fff7f7; border-color:#ffe1e1; margin-top:12px"></div>
      <div style="display:flex; justify-content:flex-end; margin-top:12px">
        <button id="auth-cancel" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Clear All confirm modal -->
  <div id="clear-modal" class="modal" aria-hidden="true" aria-labelledby="clear-title">
    <div class="sheet" style="max-width:480px">
      <div class="head">
        <strong id="clear-title">Clear current editor?</strong>
        <button id="clear-close" class="btn">✕</button>
      </div>
      <p class="muted">This will clear the Title, Summary, and Steps in the editor. Saved versions and “My SOPs” in your account are untouched.</p>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px">
        <button id="clear-cancel" class="btn">Cancel</button>
        <button id="clear-confirm" class="btn primary">Clear</button>
      </div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="overlay" role="status" aria-live="polite">
    <div class="card" style="background:#fff; border-color:#eee">
      <div id="overlay-text">Working…</div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite"></div>

  <!-- App code (module) -->
  <script type="module" src="/assets/app.js"></script>
</body>
</html>
